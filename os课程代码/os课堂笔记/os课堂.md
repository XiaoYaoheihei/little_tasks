## 进程控制

进程控制块以及`task_struct`结构



## 内核+中断环境+运行环境





## 进程同步

同步原语：

- 信号量

整型信号量

记录型信号量（高效的解决了临界资源的访问问题）

AND型信号量

信号量集

- 信号量机制的应用策略

寻找临界资源；每种临界资源定义信号量；访问临界资源前使用前申请；使用后释放

### 经典的进程同步问题

处理思路：同步模型——>进程同步分析——>同步控制——>代码验证

- 哲学家进餐问题





- 生产者-消费者问题

多生产者-多消费-单缓冲区（书上给的是多缓冲区，我的理解是单个缓冲区可以放多个数据，并不是书上给的单个缓冲区存放的单个 数据）：

- 缓冲区中资源的位置如果需要确定的话，需要记录生产的位置（in指针），消费的位置（out指针）；可以使用内核的缓冲区也可以使用自己定义的缓冲区，内核缓冲区不需要自己手动控制
- 临界资源的确定：缓冲区，位置

**生产者—消费者两者之间的同步关系，两者对共享资源的互斥访问。**

**当多线程之间有同步关系的话，一般要保证多进程对共享资源互斥访问的同时，同时还要采取相应的措施（信号量等）保证线程之间的同步。**

Q：能不能buffer不互斥访问，pro和con进入到buffer中后再判断能否存放和消费？



多生产-多消费-缓冲池（多buffer）：



- 读者-写者问题

读-读允许同时；读-写互斥；写-写互斥

## 进程间通信



## 死锁问题

### 什么是死锁问题



### 死锁问题产生的原因



### 死锁的处理策略



### 银行家算法设计思想



## 内存概述和连续分配

### 存储概述

存储层次是具有结构性，存储结构中都包含有哪些类存储



内存空间如何实现保护



深入理解什么是地址重定位，为什么要设计地址重定位？动态重定位和静态重定位的含义。



了解程序是如何进行链接？理解程序如何装入内存？



内存如何进行扩充大小——引入虚拟内存

### 连续分配

了解单一和固定分配内存管理方法的简单思想



深入理解动态分区内存管理原理，包括数据结构设计、分配和回收内存基本思想策略、基于顺序搜索的动态分区分配算法-FF  NF  BF  WF



了解基于索引搜索的动态分区分配算法，包括快速适应、伙伴系统、哈希算法



理解动态重定位分区分配，核心思想是紧凑+动态重定位，思考为什么要紧凑和动态重定位？

## 存储器管理

早期存储管理不足：

- 程序需要**一次性全部装入内存**中
- 随着多个程序的启动和结束，内存会出现**外部碎片**
- 碎片无法全部利用，通过**拼凑合并**，代价很大

如何进行优化：

### 页式存储管理（32位机器下）

每个进程**逻辑上**分为相同大小的页（4k），通过**页表**映射到具**体的物理内存块**，页表中存储的是（逻辑地址页号）和（物理地址块号）。

内存中按照页的大小分为大小相等的块，物理地址块号。

程序将虚拟地址传给CPU，CPU通过MMU计算**虚拟地址**对应的**页号以及在页内的偏移量**（根据页号直接计算出虚拟地址的前多少位是页号，后多少位是偏移量）

31                   12   11                             0

-----------|-------------

​    		页号p	  |		页内偏移量    

-----------|-------------

#### 管理页表和内存

计算进程需要多少块，分配相应的物理地址空间。

系统为**每个进程都分配了一个页表**，页表的**起始地址和长度**填入到PCB，并且存入到内存中。

#### 地址变换机构（MMU）

输入为逻辑地址，输出为物理地址

#### 具有快表（TLB）的地址转化机构——页表缓存

缓存页表中频繁访问的局部区域（页表子集）

如果每次MMU访问TLB命中的话，需要更新TLB中的值。

#### 如何进行地址转化？

页面大小直接计算出来位数。

页号=逻辑地址/页面长度

页内偏移量=逻辑地址%页面长度

**千万记得还要判断页号是否越界**

![img](file:///home/xiaoyao/%E5%9B%BE%E7%89%87/%E6%88%AA%E5%9B%BE/%E6%88%AA%E5%9B%BE%202023-05-22%2017-20-34.png)



#### 多级页表

计算机支持非常大的逻辑地址空间，**页表会很长**，需要内存大的**连续空间**存放页表，为每一个**进程都分配这么大的页表**放到内存中真的很不现实，所以，页表切割成离散分布，且仅存放当前需要的部分页表项。

- 页表分割成页，在内存中离散分布
- 程序的局部性原理，将**当前需要的页调入内存，其余页驻留在磁盘中，需要的时候再调用。**

二级页表工作原理：

- **页内地址**，直接放到MMU中的偏移位置，用于最后的拼接
- **外部页号**，通过外部页号查找到对应的页号在内存中的块号（页表号所在的块号）
- **内层页号**，通过块号中的页表和**内层页号**（每一块中都放着一页）查找出来对应的内存块号，

31                                       21                                         11                                       0

-----------------|----------------|---------------|

 一级页号（页目录号）   二级页号 （页表索引）  页内偏移量

-----------------|----------------|---------------|

#### 如何进行地址转化？

根据一级拿到块号中的页表，根据二级拿到相应的内存块号，根据内存块号和页内偏移量计算出最终要访问的物理地址。

![img](file:///home/xiaoyao/%E5%9B%BE%E7%89%87/%E6%88%AA%E5%9B%BE/%E6%88%AA%E5%9B%BE%202023-05-22%2017-18-18.png)
